<!DOCTYPE etl SYSTEM "http://scriptella.javaforge.com/dtd/etl.dtd">
<etl>
    <description>
        This example produces a HTML report
        based on the Categories table from the Northwind.mdb
    </description>
    <!-- ODBC Connection to Northwind Microsoft Access Database.
     Use the same driver name and URL syntax for other ODBC sources.-->
    <connection id="script" driver="script"/>
    <connection id="vicos" url="jdbc:mysql://localhost:3306/sdrv_slovar1" user="reader" password="reader"/>
    <connection id="django" driver="org.sqlite.JDBC" url="jdbc:sqlite:/home/lukacu/Local/sdrv/db.sqlite"/>
    <connection id="text" driver="text" url="test.txt"/>
    <connection id="comments" driver="text" url="comments.txt"/>
    <script connection-id="django">
        DELETE FROM auth_user WHERE 1 = 1
    </script>
    <query connection-id="vicos">
        SELECT username, password, TRIM(name) as name, TRIM(email) email FROM registered;
        <query connection-id="script"><![CDATA[
            var firstname, lastname;
            names = name.split(" ");
            if (names.length > 1) {
            firstname = names[0];
            lastname = names[1];
            } else {
            firstname = names[0];
            lastname = "";
            }
	    lastname = lastname.replace("Ã…Â¡", "š").replace("Ã„?", "č").replace("Ã„â€¡", "ć").replace("Ã…Â¾", "ž").replace("Ã¼", "ü");
	    firstname = firstname.replace("Ã…Â¡", "š").replace("Ã„?", "č").replace("Ã„â€¡", "ć").replace("Ã…Â¾", "ž").replace("Ã¼", "ü");
            password = "md5$" + password;
            println(password);
            query.next();
            ]]>
        <script connection-id="django">
            INSERT INTO auth_user (username, first_name, last_name, email, password, is_staff, is_active, is_superuser, last_login, date_joined) VALUES (?username, ?firstname, ?lastname, ?email, ?password, 0, 1, 0, DATETIME(), DATETIME())
        </script>
        </query>

    </query>
    <!--script connection-id="django">
        DELETE FROM dictionary_phrase WHERE 1 = 1
    </script>
    <query connection-id="vicos">
        SELECT TRIM(english) AS content, DATE_FORMAT(date_time, '%Y-%m-%d %H:%i:%s') AS created, username AS creatorname FROM wordlist;
	<query connection-id="django">
	    SELECT id AS creator FROM auth_user WHERE username = "$creatorname" LIMIT 1
	    <script connection-id="django">
	        INSERT INTO dictionary_phrase (user_id, content, created, modified) VALUES (?creator, ?content, ?created, DATETIME())
	    </script>
	</query>
    </query>
    <script connection-id="django">
        DELETE FROM dictionary_translation WHERE 1 = 1
    </script>
    <query connection-id="vicos">
        SELECT entry_id AS phrase_id_old, TRIM(slovenian) AS content, DATE_FORMAT(date_time, '%Y-%m-%d %H:%i:%s') AS created, username AS creatorname FROM translations;

	<query connection-id="vicos">
		SELECT TRIM(english) AS content_phrase FROM wordlist WHERE entry_id = "$phrase_id_old" LIMIT 1;
		<query connection-id="django">
		    SELECT id AS phrase FROM dictionary_phrase WHERE content = "$content_phrase" LIMIT 1;


        <query connection-id="script">
            content = content.replace("Ã…Â¡", "š").replace("Ã„?", "č").replace("Ã„â€¡", "ć").replace("Ã…Â¾", "ž").replace("Ã¼", "ü");
	    query.next();
		<query connection-id="django">
		    SELECT id AS creator FROM auth_user WHERE username = "$creatorname" LIMIT 1
		    <script connection-id="django">
		        INSERT INTO dictionary_translation (phrase_id, user_id, content, created) VALUES (?phrase, ?creator, ?content, ?created)
		    </script>
		</query>
        </query>

		</query>
        </query>



    </query>
    <script connection-id="django">
        DELETE FROM dictionary_vote WHERE 1 = 1
    </script>
    <query connection-id="vicos">
        SELECT entry_ID AS translation, username AS creatorname FROM voting;
        <query connection-id="django">
            SELECT id AS creator FROM auth_user WHERE username = "$creatorname" LIMIT 1
            <script connection-id="django">
                INSERT INTO dictionary_vote (user_id, translation_id, created) VALUES (?creator, ?translation, DATETIME())
            </script>
        </query>
    </query>
    <script connection-id="django">
        DELETE FROM django_comments WHERE 1 = 1
    </script-->
    <!--query connection-id="vicos">
        SELECT entry_id, comment, DATE_FORMAT(date_time, '%Y-%m-%d %H:%i:%s') AS created, username AS creatorname FROM comments;
        <query connection-id="django">
            SELECT id AS creator, username, email FROM auth_user WHERE username = "$creatorname" LIMIT 1
            <script connection-id="django">
                INSERT INTO django_comments (user_id, user_name, user_email, user_url, comment, content_type_id, object_pk, site_id, submit_date, is_public, is_removed) VALUES (?creator, ?username, ?email, '', '', 14, ?entry_id, 1, ?created, 1, 0)
            </script>
        </query>
    </query-->
</etl>
